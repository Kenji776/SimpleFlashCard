/* Keep container the same, but isolate stacking so z-index works cleanly */
.mascot-container{
  position:absolute;
  bottom:-10px;
  right:20px;
  width:150px;
  height:150px;
  z-index:100;
  isolation:isolate; /* new */
}

.mascot-container .mascot-image{
  width:150px;
  height:150px;
  z-index:1001;
  cursor: url("media/punch_1.png") 16 16, grabbing;

  /* for punch animation */
  position:relative;
  display:inline-block;
  transform-origin:60% 40%;
  transition: transform 90ms ease, filter 90ms ease;
}

/* Hover: ready */
.mascot-container .mascot-image:hover{
  cursor: url("media/punch_1.png") 16 16, pointer;
}

/* Clicked state: swap cursor + immediate shove */
.mascot-container .mascot-image:active{
  cursor: url("media/punch_2.png") 16 16, grabbing;
  filter: contrast(1.15) brightness(1.05);
}

/* Speedier, more obvious travel — applied via .punching class (JS below) */
.mascot-container .mascot-image.punching{
  animation: fist-shove 140ms cubic-bezier(.2,.9,.2,1) 1;
}

/* Speed lines + impact pop (only while mouse is down) */
.mascot-container .mascot-image:active::before,
.mascot-container .mascot-image.punching::before{
  content:"";
  position:absolute;
  top:55%;
  left:-36px;
  width:88px;
  height:4px;
  background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.85) 50%, rgba(255,255,255,0) 100%);
  filter: blur(1px);
  opacity:.95;
  transform: translateY(-50%);
  pointer-events:none;
  animation: speed-lines 140ms ease-out forwards;
  mix-blend-mode: lighten;
  z-index:1002;
}

.mascot-container .mascot-image:active::after,
.mascot-container .mascot-image.punching::after{
  content:"";
  position:absolute;
  top:55%;
  left:50%;
  width:10px; height:10px;
  border:2px solid rgba(255,255,255,.9);
  border-radius:50%;
  pointer-events:none;
  transform: translate(-50%,-50%) scale(.3);
  opacity:1;
  animation: impact-pop 220ms cubic-bezier(.2,.7,.2,1) forwards;
  z-index:1003;
}

/* ——— put the speech bubble back on top ——— */
.bubble { z-index: 2000; }                /* raise above .mascot-image (1001) */
.bubble-bottom-left:before,
.bubble-bottom-right:before { z-index:2001; }

/* Your existing classes below (unchanged other than px fixes where needed) */
.mascot-container .mascot-fart-cloud{
  background-size:100% 100%;
  width:174px; height:178px;
  position:absolute; z-index:1000;
  top:40px; left:-120px;
}
.correct-anwer-image{ background-image:url("media/shibaHappy.png"); }
.incorrect-anwer-image{ background-image:url("media/shibaSad.png"); }
.confused-image{ background-image:url("media/shibaConfused.png"); }

.bubble {
  position:absolute; bottom:120px; right:10px;
  font-family:sans-serif; font-size:1.125rem; line-height:24px;
  min-width:300px; background:#fff; border-radius:30px; padding:24px;
  text-align:center; color:#000; opacity:.80;
}
.bubble-bottom-left:before {
  content:""; width:0; height:0; position:absolute;
  border-left:24px solid #fff; border-right:12px solid transparent;
  border-top:12px solid #fff; border-bottom:20px solid transparent;
  left:32px; bottom:-32px; opacity:.80;
}
.bubble-bottom-right:before {
  content:""; width:0; height:0; position:absolute;
  border-left:24px solid #fff; border-right:12px solid transparent;
  border-top:12px solid #fff; border-bottom:20px solid transparent;
  right:32px; bottom:-24px; opacity:.80;
}

.leave-right { animation: leave-right 5s linear 1; }
@keyframes leave-right {
  0% { opacity:1; transform:translateX(0) rotate(0deg); }
  100% { opacity:0; transform:translateX(100%) translateY(-300%) rotate(120deg); }
}

.hit-impact { animation: hit-impact 0.05s linear 1; }
@keyframes hit-impact {
  0% { opacity:1; transform:translateY(0) scale(1); }
  50% { transform:translateY(-15%) scale(.80); }
  100% { transform:translateY(0) scale(1); }
}

@keyframes idle-dance {
  from, to { transform:scale(1,1); }
  25% { transform:scale(0.9,1.1); }
  50% { transform:scale(1.1,0.9); }
  75% { transform:scale(0.95,1.05); }
}

.close-speech-link{
  text-decoration:underline;
  color:#04AA6D;
  cursor:pointer;
}

/* New punch keyframes */
@keyframes fist-shove {
  0%   { transform: translate(0,0) scale(1) rotate(0deg); }
  55%  { transform: translate(-18px,12px) scale(.82) rotate(-10deg); } /* big move */
  100% { transform: translate(0,0) scale(1) rotate(0deg); }            /* recoil */
}

@keyframes speed-lines {
  0%   { transform: translate(-10px,-50%) scaleX(.2); opacity:0; }
  40%  { opacity:.95; }
  100% { transform: translate(-120px,-50%) scaleX(1); opacity:0; }
}

@keyframes impact-pop {
  0%   { transform: translate(-50%,-50%) scale(.3); opacity:1; }
  70%  { transform: translate(-50%,-50%) scale(1.4); opacity:.9; }
  100% { transform: translate(-50%,-50%) scale(1.8); opacity:0; }
}

/* --- Life bar --- */
.mascot-container .life-bar{
  position: absolute;
  bottom: -16px;
  left: 0%;
  width: 150px;                /* match mascot width exactly */
  height: 14px;
  transform: translate(-50%, 8px);  /* pop-in offset */
  opacity: 0;
  transition: opacity 160ms ease, transform 160ms ease;
  background: rgba(0,0,0,.5);
  border: 2px solid rgba(255,255,255,.9);
  border-radius: 10px;
  overflow: hidden;
  z-index: 3000;
  pointer-events: none;
}
.mascot-container .life-bar.visible {
  opacity: 1;
  transform: translateY(0);
}
.mascot-container .life-fill {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg, #43e97b, #38f9d7);
  transition: width 140ms ease;
}
.mascot-container .life-fill.low  { background: linear-gradient(90deg, #ff9966, #ff5e62); }
.mascot-container .life-fill.crit { background: linear-gradient(90deg, #ff416c, #ff4b2b); }

/* --- Explosion FX --- */
.mascot-container .explosion-sprite {
  position: absolute;
  width: 180px; height: 180px;
  top: -15px; right: -15px;
  background-size: cover;
  pointer-events: none;
  z-index: 4000;
  animation: explode-pop 600ms cubic-bezier(.2,.8,.2,1) forwards;
}

@keyframes explode-pop {
  0%   { transform: scale(.6); opacity: .0; filter: brightness(1); }
  20%  { transform: scale(1.2); opacity: 1;  filter: brightness(1.2); }
  60%  { transform: scale(1.0); opacity: .95; }
  100% { transform: scale(1.6) rotate(8deg); opacity: 0; filter: blur(2px); }
}

/* Optional: hide the mascot on KO */
.mascot-container .mascot-image.ko {
  opacity: 0;
  transition: opacity 120ms ease;
}

/* quick scale-in when he’s rescued */
.pop-in { animation: pop-in .28s ease-out; }
@keyframes pop-in {
  0% { transform: scale(.85) rotate(0deg); opacity: .85; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}